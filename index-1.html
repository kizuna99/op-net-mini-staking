<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OP_STAKE Dashboard</title>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #0b0f1a;
    color: #e5e7eb;
    font-family: Arial, sans-serif;
  }

  .container {
    max-width: 1000px;
    margin: auto;
    padding: 30px 24px 60px;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 12px;
  }
  .logo {
    font-size: 22px;
    font-weight: bold;
    color: #f7931a;
  }

  /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
  button {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  .connect    { background: #f7931a; color: #000; }
  .stake-btn  { background: #22c55e; color: #000; }
  .reward-btn { background: #3b82f6; color: #fff; }
  .withdraw-btn { background: #ef4444; color: #fff; margin-left: 8px; }

  /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
  .card {
    background: #141a2b;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .card h3 { margin-bottom: 14px; font-size: 15px; color: #e5e7eb; }

  /* ‚îÄ‚îÄ Stats ‚îÄ‚îÄ */
  .stats {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .stat {
    flex: 1;
    min-width: 140px;
    background: #1c2236;
    padding: 15px;
    border-radius: 8px;
  }
  .stat-label { font-size: 12px; color: #9ca3af; margin-bottom: 6px; }
  .stat-value { font-size: 18px; font-weight: bold; color: #f7931a; }

  /* ‚îÄ‚îÄ APY Banner ‚îÄ‚îÄ */
  .apy-banner {
    background: #1a2238;
    border-left: 3px solid #22c55e;
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
    color: #22c55e;
  }

  /* ‚îÄ‚îÄ Stake Controls ‚îÄ‚îÄ */
  .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  input {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #2d3748;
    background: #0d1117;
    color: #e5e7eb;
    width: 130px;
    font-size: 14px;
  }
  input:focus { outline: 1px solid #f7931a; }

  /* ‚îÄ‚îÄ History ‚îÄ‚îÄ */
  .history-item {
    font-size: 13px;
    padding: 8px 0;
    border-bottom: 1px solid #1e2a40;
    color: #9ca3af;
  }
  .history-item:last-child { border-bottom: none; }
  .badge {
    display: inline-block;
    font-size: 11px;
    font-weight: bold;
    padding: 2px 7px;
    border-radius: 4px;
    margin-right: 6px;
  }
  .badge-stake    { background: rgba(34,197,94,0.15);  color: #22c55e; }
  .badge-reward   { background: rgba(59,130,246,0.15); color: #60a5fa; }
  .badge-withdraw { background: rgba(239,68,68,0.15);  color: #f87171; }

  /* ‚îÄ‚îÄ Chart Card ‚îÄ‚îÄ */
  .chart-card {
    background: #141a2b;
    padding: 20px 20px 16px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 8px;
  }
  .chart-title { font-size: 15px; font-weight: bold; color: #e5e7eb; }
  .chart-pill {
    font-size: 11px;
    background: rgba(247,147,26,0.12);
    border: 1px solid rgba(247,147,26,0.3);
    color: #f7931a;
    padding: 3px 10px;
    border-radius: 20px;
  }
  .chart-wrap {
    position: relative;
    width: 100%;
    height: 220px;
  }
</style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">

const { useState, useEffect, useRef } = React;

/* ‚îÄ‚îÄ‚îÄ Generate 30-day BTC staking growth dataset ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function generateChartData(currentStaked) {
  const labels = [];
  const values = [];
  const now = Date.now();
  const seed = currentStaked > 0 ? currentStaked : 0.5; // demo baseline

  for (let i = 29; i >= 0; i--) {
    const d = new Date(now - i * 86400000);
    labels.push(d.toLocaleDateString("en-US", { month: "short", day: "numeric" }));

    // Compound growth: principal √ó (1 + daily_rate)^day + subtle noise
    const dayIndex  = 29 - i;
    const dailyRate = 0.125 / 365;
    const growth    = seed * Math.pow(1 + dailyRate, dayIndex);
    const noise     = (Math.random() - 0.48) * seed * 0.004;
    values.push(Math.max(0, growth + noise));
  }
  return { labels, values };
}

/* ‚îÄ‚îÄ‚îÄ Performance Chart (vanilla Chart.js inside a React ref) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function PerformanceChart({ staked }) {
  const canvasRef = useRef(null);
  const chartRef  = useRef(null);

  useEffect(() => {
    const { labels, values } = generateChartData(staked);

    // Destroy previous instance before re-creating
    if (chartRef.current) {
      chartRef.current.destroy();
    }

    const ctx = canvasRef.current.getContext("2d");

    // Gradient fill
    const gradient = ctx.createLinearGradient(0, 0, 0, 220);
    gradient.addColorStop(0,   "rgba(247,147,26,0.35)");
    gradient.addColorStop(1,   "rgba(247,147,26,0.01)");

    chartRef.current = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "BTC Value",
          data: values,
          borderColor: "#f7931a",
          borderWidth: 2,
          pointRadius: 0,
          pointHoverRadius: 4,
          pointHoverBackgroundColor: "#f7931a",
          tension: 0.45,          // smooth curve
          fill: true,
          backgroundColor: gradient,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: "index",
          intersect: false,
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: "#1c2236",
            titleColor: "#9ca3af",
            bodyColor: "#f7931a",
            borderColor: "#2d3a55",
            borderWidth: 1,
            padding: 10,
            callbacks: {
              label: ctx => ` ${ctx.parsed.y.toFixed(6)} BTC`
            }
          }
        },
        scales: {
          x: {
            grid:  { color: "rgba(255,255,255,0.04)" },
            ticks: {
              color: "#6b7280",
              font: { size: 10 },
              maxTicksLimit: 8,
              maxRotation: 0,
            },
            border: { color: "rgba(255,255,255,0.06)" }
          },
          y: {
            grid:  { color: "rgba(255,255,255,0.04)" },
            ticks: {
              color: "#6b7280",
              font: { size: 10 },
              callback: v => v.toFixed(4)
            },
            border: { color: "rgba(255,255,255,0.06)" }
          }
        }
      }
    });

    return () => {
      if (chartRef.current) chartRef.current.destroy();
    };
  }, [staked]); // re-draw whenever staked amount changes

  return (
    <div className="chart-card">
      <div className="chart-header">
        <div className="chart-title">üìà 30-Day BTC Staking Growth</div>
        <div className="chart-pill">APY 12.5% ¬∑ Simulated</div>
      </div>
      <div className="chart-wrap">
        <canvas ref={canvasRef}></canvas>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ Main App ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function App() {
  const [connected, setConnected] = useState(false);
  const [balance,   setBalance]   = useState(1.0);
  const [staked,    setStaked]    = useState(0);
  const [reward,    setReward]    = useState(0);
  const [amount,    setAmount]    = useState("");
  const [history,   setHistory]   = useState([]);

  const connect = () => setConnected(true);

  const stake = () => {
    const amt = parseFloat(amount);
    if (!amt || amt <= 0 || amt > balance) return;
    setBalance(b => b - amt);
    setStaked(s => s + amt);
    setHistory(h => [{
      type: "Stake", amount: amt,
      date: new Date().toLocaleString(),
      tx: "0x" + Math.random().toString(16).slice(2, 10)
    }, ...h]);
    setAmount("");
  };

  const simulateReward = () => {
    if (staked <= 0) return;
    const earned = parseFloat((staked * 0.01).toFixed(8));
    setReward(r => r + earned);
    setHistory(h => [{
      type: "Reward", amount: earned,
      date: new Date().toLocaleString(),
      tx: "0x" + Math.random().toString(16).slice(2, 10)
    }, ...h]);
  };

  const withdraw = () => {
    if (staked <= 0) return;
    const total = staked + reward;
    setBalance(b => b + total);
    setHistory(h => [{
      type: "Withdraw", amount: total,
      date: new Date().toLocaleString(),
      tx: "0x" + Math.random().toString(16).slice(2, 10)
    }, ...h]);
    setStaked(0);
    setReward(0);
  };

  const badgeClass = type =>
    type === "Stake" ? "badge-stake" :
    type === "Reward" ? "badge-reward" : "badge-withdraw";

  return (
    <div className="container">

      {/* Header */}
      <div className="header">
        <div>
          <div className="logo">OP_STAKE</div>
          <div style={{ fontSize: "12px", color: "#9ca3af", marginTop: 4 }}>
            Native Bitcoin L1 Staking Protocol ‚Äî OP_NET Testnet
          </div>
        </div>
        {!connected
          ? <button className="connect" onClick={connect}>Connect OP_Wallet</button>
          : <div style={{ fontSize: "12px", color: "#9ca3af" }}>
              <span style={{ color: "#22c55e", marginRight: 6 }}>‚óè</span>
              bc1q8f3x...92kp ¬∑ OP_NET
            </div>
        }
      </div>

      {!connected ? (
        <div className="card" style={{ textAlign: "center", padding: "40px 20px", color: "#9ca3af" }}>
          Connect your wallet to start staking BTC on OP_NET.
        </div>
      ) : (
        <>
          {/* Stats */}
          <div className="stats">
            <div className="stat">
              <div className="stat-label">Wallet Balance</div>
              <div className="stat-value">{balance.toFixed(6)} BTC</div>
            </div>
            <div className="stat">
              <div className="stat-label">Total Staked</div>
              <div className="stat-value">{staked.toFixed(6)} BTC</div>
            </div>
            <div className="stat">
              <div className="stat-label">Rewards Earned</div>
              <div className="stat-value" style={{ color: "#22c55e" }}>{reward.toFixed(8)} BTC</div>
            </div>
          </div>

          {/* APY Banner */}
          <div className="apy-banner">
            üîí Fixed APY: 12.5% ‚Äî Rewards accrue per simulation cycle
          </div>

          {/* ‚îÄ‚îÄ Performance Chart ‚îÄ‚îÄ */}
          <PerformanceChart staked={staked} />

          {/* Stake Controls */}
          <div className="card">
            <h3>Stake BTC</h3>
            <div className="controls">
              <input
                type="number"
                value={amount}
                onChange={e => setAmount(e.target.value)}
                placeholder="Amount (BTC)"
                min="0"
                step="0.0001"
              />
              <button className="stake-btn"  onClick={stake}>Stake</button>
              <button className="reward-btn" onClick={simulateReward}>Simulate Reward</button>
              <button className="withdraw-btn" onClick={withdraw}>Withdraw All</button>
            </div>
          </div>

          {/* Transaction History */}
          <div className="card">
            <h3>Transaction History</h3>
            {history.length === 0 && (
              <div className="history-item" style={{ borderBottom: "none" }}>No transactions yet.</div>
            )}
            {history.map((h, i) => (
              <div key={i} className="history-item">
                <span className={`badge ${badgeClass(h.type)}`}>{h.type}</span>
                <strong>{h.amount.toFixed(8)} BTC</strong>
                <br />
                <span style={{ fontSize: "11px", color: "#6b7280" }}>
                  TX: {h.tx} ¬∑ {h.date}
                </span>
              </div>
            ))}
          </div>

        </>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>
