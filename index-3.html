<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OP_STAKE Dashboard</title>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #0b0f1a;
    color: #e5e7eb;
    font-family: Arial, sans-serif;
  }

  .container {
    max-width: 1000px;
    margin: auto;
    padding: 30px 24px 60px;
  }

  /* â”€â”€ Header â”€â”€ */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 12px;
  }
  .logo {
    font-size: 22px;
    font-weight: bold;
    color: #f7931a;
  }

  /* â”€â”€ Buttons â”€â”€ */
  button {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  .connect    { background: #f7931a; color: #000; }
  .stake-btn  { background: #22c55e; color: #000; }
  .reward-btn { background: #3b82f6; color: #fff; }
  .withdraw-btn { background: #ef4444; color: #fff; margin-left: 8px; }

  /* â”€â”€ Cards â”€â”€ */
  .card {
    background: #141a2b;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .card h3 { margin-bottom: 14px; font-size: 15px; color: #e5e7eb; }

  /* â”€â”€ Stats â”€â”€ */
  .stats {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .stat {
    flex: 1;
    min-width: 140px;
    background: #1c2236;
    padding: 15px;
    border-radius: 8px;
  }
  .stat-label { font-size: 12px; color: #9ca3af; margin-bottom: 6px; }
  .stat-value { font-size: 18px; font-weight: bold; color: #f7931a; }

  /* â”€â”€ TVL Card â”€â”€ */
  .stat-tvl {
    flex: 1;
    min-width: 140px;
    padding: 15px;
    border-radius: 8px;
    background: linear-gradient(135deg, #1a2a1a 0%, #1c2236 100%);
    border: 1px solid rgba(34,197,94,0.25);
    position: relative;
    overflow: hidden;
  }
  .stat-tvl::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at top left, rgba(34,197,94,0.07) 0%, transparent 70%);
    pointer-events: none;
  }
  .stat-tvl .stat-label { color: #86efac; }
  .stat-tvl .stat-value { color: #22c55e; font-size: 20px; }
  .tvl-delta {
    font-size: 11px;
    margin-top: 5px;
    font-weight: bold;
    transition: opacity 0.4s;
  }
  .tvl-delta.up   { color: #22c55e; }
  .tvl-delta.down { color: #f87171; }
  .tvl-delta.flat { color: #6b7280; opacity: 0; }

  /* â”€â”€ APY Banner â”€â”€ */
  .apy-banner {
    background: #1a2238;
    border-left: 3px solid #22c55e;
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
    color: #22c55e;
  }

  /* â”€â”€ Stake Controls â”€â”€ */
  .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  input {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #2d3748;
    background: #0d1117;
    color: #e5e7eb;
    width: 130px;
    font-size: 14px;
  }
  input:focus { outline: 1px solid #f7931a; }

  /* â”€â”€ History â”€â”€ */
  .history-item {
    font-size: 13px;
    padding: 8px 0;
    border-bottom: 1px solid #1e2a40;
    color: #9ca3af;
  }
  .history-item:last-child { border-bottom: none; }
  .badge {
    display: inline-block;
    font-size: 11px;
    font-weight: bold;
    padding: 2px 7px;
    border-radius: 4px;
    margin-right: 6px;
  }
  .badge-stake    { background: rgba(34,197,94,0.15);  color: #22c55e; }
  .badge-reward   { background: rgba(59,130,246,0.15); color: #60a5fa; }
  .badge-withdraw { background: rgba(239,68,68,0.15);  color: #f87171; }

  /* â”€â”€ Lock Period Selector â”€â”€ */
  .lock-row {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }
  .lock-label {
    font-size: 13px;
    color: #9ca3af;
    white-space: nowrap;
  }
  select {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #2d3748;
    background: #0d1117;
    color: #e5e7eb;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%239ca3af' d='M1 1l5 5 5-5'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    padding-right: 30px;
    min-width: 180px;
  }
  select:focus { border-color: #f7931a; }

  /* APY pill shown next to dropdown */
  .apy-live-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: rgba(247,147,26,0.1);
    border: 1px solid rgba(247,147,26,0.35);
    color: #f7931a;
    font-size: 13px;
    font-weight: bold;
    padding: 5px 12px;
    border-radius: 20px;
    transition: all 0.3s;
  }
  .apy-live-pill .apy-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: #f7931a;
    box-shadow: 0 0 6px #f7931a;
    animation: blink 1.6s infinite;
  }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* â”€â”€ Lock Status Panel (inside Stake card) â”€â”€ */
  .lock-status-box {
    margin-top: 16px;
    padding: 14px 16px;
    border-radius: 8px;
    border: 1px solid;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }
  .lock-status-box.locked {
    background: rgba(239,68,68,0.05);
    border-color: rgba(239,68,68,0.25);
  }
  .lock-status-box.unlocked {
    background: rgba(34,197,94,0.05);
    border-color: rgba(34,197,94,0.25);
  }
  .lock-status-box.idle {
    background: rgba(107,114,128,0.06);
    border-color: rgba(107,114,128,0.2);
  }
  .lock-info-line {
    font-size: 13px;
    color: #9ca3af;
    margin-bottom: 4px;
  }
  .lock-info-line strong { color: #e5e7eb; }
  .lock-countdown {
    font-size: 11px;
    color: #6b7280;
    margin-top: 3px;
    font-variant-numeric: tabular-nums;
  }

  /* Lock / Unlock status badge */
  .lock-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    font-weight: bold;
    padding: 4px 10px;
    border-radius: 20px;
    white-space: nowrap;
  }
  .lock-badge.locked   { background: rgba(239,68,68,0.15);  color: #f87171; }
  .lock-badge.unlocked { background: rgba(34,197,94,0.15);  color: #22c55e; }
  .lock-badge.idle     { background: rgba(107,114,128,0.12); color: #9ca3af; }

  /* Withdraw disabled tooltip wrapper */
  .withdraw-wrap {
    position: relative;
    display: inline-block;
    margin-left: 8px;
  }
  .withdraw-wrap .tip {
    display: none;
    position: absolute;
    bottom: calc(100% + 6px);
    left: 50%;
    transform: translateX(-50%);
    background: #1c2236;
    border: 1px solid #2d3a55;
    color: #f87171;
    font-size: 11px;
    font-weight: normal;
    padding: 5px 10px;
    border-radius: 6px;
    white-space: nowrap;
    pointer-events: none;
    z-index: 10;
  }
  .withdraw-wrap:hover .tip { display: block; }
  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  /* â”€â”€ Chart Card â”€â”€ */
  .chart-card {
    background: #141a2b;
    padding: 20px 20px 16px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 8px;
  }
  .chart-title { font-size: 15px; font-weight: bold; color: #e5e7eb; }
  .chart-pill {
    font-size: 11px;
    background: rgba(247,147,26,0.12);
    border: 1px solid rgba(247,147,26,0.3);
    color: #f7931a;
    padding: 3px 10px;
    border-radius: 20px;
  }
  .chart-wrap {
    position: relative;
    width: 100%;
    height: 220px;
  }
</style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">

const { useState, useEffect, useRef } = React;

/* â”€â”€â”€ Animated TVL Counter hook â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Smoothly animates displayed value from its current position to `target`
   using an ease-out quad curve over `duration` ms via requestAnimationFrame.
   Returns { display, delta } where delta shows the change badge.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function useTVLCounter(target, duration = 900) {
  const [display, setDisplay] = useState(target);
  const [delta,   setDelta]   = useState({ text: "", dir: "flat" });

  const rafRef  = useRef(null);
  const fromRef = useRef(target);  // animated value at start of current tween

  useEffect(() => {
    if (rafRef.current) cancelAnimationFrame(rafRef.current);

    const startVal = fromRef.current;
    const diff     = target - startVal;
    if (Math.abs(diff) < 0.000001) return;

    // Show delta badge
    const sign = diff > 0 ? "+" : "";
    setDelta({ text: `${sign}${diff.toFixed(4)} BTC`, dir: diff > 0 ? "up" : "down" });

    const hideTimer = setTimeout(
      () => setDelta(d => ({ ...d, dir: "flat" })), 2800
    );

    const startTime = performance.now();

    const tick = (now) => {
      const progress = Math.min((now - startTime) / duration, 1);
      const eased    = 1 - (1 - progress) * (1 - progress); // ease-out quad
      const current  = startVal + diff * eased;

      fromRef.current = current;
      setDisplay(current);

      if (progress < 1) {
        rafRef.current = requestAnimationFrame(tick);
      } else {
        fromRef.current = target;
      }
    };

    rafRef.current = requestAnimationFrame(tick);
    return () => {
      if (rafRef.current) cancelAnimationFrame(rafRef.current);
      clearTimeout(hideTimer);
    };
  }, [target]);

  return { display, delta };
}

/* â”€â”€â”€ Generate 30-day BTC staking growth dataset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function generateChartData(currentStaked) {
  const labels = [];
  const values = [];
  const now = Date.now();
  const seed = currentStaked > 0 ? currentStaked : 0.5; // demo baseline

  for (let i = 29; i >= 0; i--) {
    const d = new Date(now - i * 86400000);
    labels.push(d.toLocaleDateString("en-US", { month: "short", day: "numeric" }));

    // Compound growth: principal Ã— (1 + daily_rate)^day + subtle noise
    const dayIndex  = 29 - i;
    const dailyRate = 0.125 / 365;
    const growth    = seed * Math.pow(1 + dailyRate, dayIndex);
    const noise     = (Math.random() - 0.48) * seed * 0.004;
    values.push(Math.max(0, growth + noise));
  }
  return { labels, values };
}

/* â”€â”€â”€ Performance Chart (vanilla Chart.js inside a React ref) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function PerformanceChart({ staked }) {
  const canvasRef = useRef(null);
  const chartRef  = useRef(null);

  useEffect(() => {
    const { labels, values } = generateChartData(staked);

    // Destroy previous instance before re-creating
    if (chartRef.current) {
      chartRef.current.destroy();
    }

    const ctx = canvasRef.current.getContext("2d");

    // Gradient fill
    const gradient = ctx.createLinearGradient(0, 0, 0, 220);
    gradient.addColorStop(0,   "rgba(247,147,26,0.35)");
    gradient.addColorStop(1,   "rgba(247,147,26,0.01)");

    chartRef.current = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "BTC Value",
          data: values,
          borderColor: "#f7931a",
          borderWidth: 2,
          pointRadius: 0,
          pointHoverRadius: 4,
          pointHoverBackgroundColor: "#f7931a",
          tension: 0.45,          // smooth curve
          fill: true,
          backgroundColor: gradient,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: "index",
          intersect: false,
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: "#1c2236",
            titleColor: "#9ca3af",
            bodyColor: "#f7931a",
            borderColor: "#2d3a55",
            borderWidth: 1,
            padding: 10,
            callbacks: {
              label: ctx => ` ${ctx.parsed.y.toFixed(6)} BTC`
            }
          }
        },
        scales: {
          x: {
            grid:  { color: "rgba(255,255,255,0.04)" },
            ticks: {
              color: "#6b7280",
              font: { size: 10 },
              maxTicksLimit: 8,
              maxRotation: 0,
            },
            border: { color: "rgba(255,255,255,0.06)" }
          },
          y: {
            grid:  { color: "rgba(255,255,255,0.04)" },
            ticks: {
              color: "#6b7280",
              font: { size: 10 },
              callback: v => v.toFixed(4)
            },
            border: { color: "rgba(255,255,255,0.06)" }
          }
        }
      }
    });

    return () => {
      if (chartRef.current) chartRef.current.destroy();
    };
  }, [staked]); // re-draw whenever staked amount changes

  return (
    <div className="chart-card">
      <div className="chart-header">
        <div className="chart-title">ğŸ“ˆ 30-Day BTC Staking Growth</div>
        <div className="chart-pill">APY 12.5% Â· Simulated</div>
      </div>
      <div className="chart-wrap">
        <canvas ref={canvasRef}></canvas>
      </div>
    </div>
  );
}

/* â”€â”€â”€ Lock Period Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const LOCK_PERIODS = [
  { label: "7 Days  â€” 10% APY",  days:  7, apy: 10  },
  { label: "30 Days â€” 15% APY",  days: 30, apy: 15  },
  { label: "90 Days â€” 18% APY",  days: 90, apy: 18  },
];

/* â”€â”€â”€ Countdown helper: returns human-readable time left â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function timeLeft(expiryTs) {
  const diff = expiryTs - Date.now();
  if (diff <= 0) return null;
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000)  / 60000);
  if (d > 0) return `${d}d ${h}h remaining`;
  if (h > 0) return `${h}h ${m}m remaining`;
  return `${m}m remaining`;
}

/* â”€â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function App() {
  const [connected,  setConnected]  = useState(false);
  const [balance,    setBalance]    = useState(1.0);
  const [staked,     setStaked]     = useState(0);
  const [reward,     setReward]     = useState(0);
  const [amount,     setAmount]     = useState("");
  const [history,    setHistory]    = useState([]);
  const [tvl,        setTvl]        = useState(125.34);
  const [lockIndex,  setLockIndex]  = useState(0);          // selected dropdown index
  const [lockExpiry, setLockExpiry] = useState(null);       // timestamp ms, null = no active lock
  const [, setTick] = useState(0);                          // forces re-render for countdown

  const { display: tvlDisplay, delta: tvlDelta } = useTVLCounter(tvl);

  // Re-render every 30 s so countdown stays fresh
  useEffect(() => {
    const id = setInterval(() => setTick(t => t + 1), 30000);
    return () => clearInterval(id);
  }, []);

  const selectedLock = LOCK_PERIODS[lockIndex];
  const isLocked     = lockExpiry !== null && Date.now() < lockExpiry;
  const isUnlocked   = lockExpiry !== null && Date.now() >= lockExpiry;
  const countdown    = lockExpiry ? timeLeft(lockExpiry) : null;

  const connect = () => setConnected(true);

  const stake = () => {
    const amt = parseFloat(amount);
    if (!amt || amt <= 0 || amt > balance) return;
    const expiry = Date.now() + selectedLock.days * 86400000;
    setBalance(b => b - amt);
    setStaked(s => s + amt);
    setTvl(t => parseFloat((t + amt).toFixed(8)));
    setLockExpiry(expiry);
    setHistory(h => [{
      type: "Stake", amount: amt,
      date: new Date().toLocaleString(),
      tx: "0x" + Math.random().toString(16).slice(2, 10),
      lockDays: selectedLock.days,
      apy: selectedLock.apy,
      lockUntil: new Date(expiry).toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" }),
    }, ...h]);
    setAmount("");
  };

  const simulateReward = () => {
    if (staked <= 0) return;
    const earned = parseFloat((staked * 0.01).toFixed(8));
    setReward(r => r + earned);
    setHistory(h => [{
      type: "Reward", amount: earned,
      date: new Date().toLocaleString(),
      tx: "0x" + Math.random().toString(16).slice(2, 10)
    }, ...h]);
  };

  const withdraw = () => {
    if (staked <= 0 || isLocked) return;
    const total = staked + reward;
    setBalance(b => b + total);
    setTvl(t => parseFloat((t - staked).toFixed(8)));
    setHistory(h => [{
      type: "Withdraw", amount: total,
      date: new Date().toLocaleString(),
      tx: "0x" + Math.random().toString(16).slice(2, 10)
    }, ...h]);
    setStaked(0);
    setReward(0);
    setLockExpiry(null);
  };

  const badgeClass = type =>
    type === "Stake" ? "badge-stake" :
    type === "Reward" ? "badge-reward" : "badge-withdraw";

  return (
    <div className="container">

      {/* Header */}
      <div className="header">
        <div>
          <div className="logo">OP_STAKE</div>
          <div style={{ fontSize: "12px", color: "#9ca3af", marginTop: 4 }}>
            Native Bitcoin L1 Staking Protocol â€” OP_NET Testnet
          </div>
        </div>
        {!connected
          ? <button className="connect" onClick={connect}>Connect OP_Wallet</button>
          : <div style={{ fontSize: "12px", color: "#9ca3af" }}>
              <span style={{ color: "#22c55e", marginRight: 6 }}>â—</span>
              bc1q8f3x...92kp Â· OP_NET
            </div>
        }
      </div>

      {!connected ? (
        <div className="card" style={{ textAlign: "center", padding: "40px 20px", color: "#9ca3af" }}>
          Connect your wallet to start staking BTC on OP_NET.
        </div>
      ) : (
        <>
          {/* Stats */}
          <div className="stats">
            {/* TVL â€” always first, highlighted */}
            <div className="stat stat-tvl">
              <div className="stat-label">ğŸŒ Global TVL</div>
              <div className="stat-value">{tvlDisplay.toFixed(4)} BTC</div>
              <div className={`tvl-delta ${tvlDelta.dir}`}>{tvlDelta.text}</div>
            </div>
            <div className="stat">
              <div className="stat-label">Wallet Balance</div>
              <div className="stat-value">{balance.toFixed(6)} BTC</div>
            </div>
            <div className="stat">
              <div className="stat-label">Total Staked</div>
              <div className="stat-value">{staked.toFixed(6)} BTC</div>
            </div>
            <div className="stat">
              <div className="stat-label">Rewards Earned</div>
              <div className="stat-value" style={{ color: "#22c55e" }}>{reward.toFixed(8)} BTC</div>
            </div>
          </div>

          {/* APY Banner â€” updates live with selected lock period */}
          <div className="apy-banner" style={{ display:"flex", alignItems:"center", justifyContent:"space-between", flexWrap:"wrap", gap:"8px" }}>
            <span>ğŸ”’ Lock Period Staking â€” Variable APY based on lock duration</span>
            <span className="apy-live-pill">
              <span className="apy-dot"></span>
              {selectedLock.apy}% APY Â· {selectedLock.days}d lock
            </span>
          </div>

          {/* â”€â”€ Performance Chart â”€â”€ */}
          <PerformanceChart staked={staked} />

          {/* Stake Controls */}
          <div className="card">
            <h3>Stake BTC</h3>

            {/* Lock period dropdown + live APY pill */}
            <div className="lock-row">
              <span className="lock-label">Lock Period:</span>
              <select
                value={lockIndex}
                onChange={e => setLockIndex(Number(e.target.value))}
                disabled={staked > 0}
              >
                {LOCK_PERIODS.map((lp, i) => (
                  <option key={i} value={i}>{lp.label}</option>
                ))}
              </select>
              <span className="apy-live-pill">
                <span className="apy-dot"></span>
                {selectedLock.apy}% APY
              </span>
            </div>

            {/* Amount + action buttons */}
            <div className="controls">
              <input
                type="number"
                value={amount}
                onChange={e => setAmount(e.target.value)}
                placeholder="Amount (BTC)"
                min="0"
                step="0.0001"
              />
              <button className="stake-btn" onClick={stake} disabled={staked > 0}>
                Stake
              </button>
              <button className="reward-btn" onClick={simulateReward}>
                Simulate Reward
              </button>

              {/* Withdraw â€” disabled with tooltip while locked */}
              <div className="withdraw-wrap">
                <button
                  className="withdraw-btn"
                  onClick={withdraw}
                  disabled={isLocked || staked <= 0}
                >
                  Withdraw All
                </button>
                {isLocked && (
                  <span className="tip">
                    ğŸ”’ Locked until {new Date(lockExpiry).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}
                  </span>
                )}
              </div>
            </div>

            {/* Lock status box â€” only shown once a stake is active */}
            {staked > 0 && (
              <div className={`lock-status-box ${isLocked ? "locked" : isUnlocked ? "unlocked" : "idle"}`}>
                <div>
                  <div className="lock-info-line">
                    Locked Until: <strong>
                      {lockExpiry
                        ? new Date(lockExpiry).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})
                        : "â€”"}
                    </strong>
                  </div>
                  <div className="lock-info-line" style={{marginTop:"4px"}}>
                    APY: <strong style={{color:"#f7931a"}}>{selectedLock.apy}%</strong>
                    &nbsp;Â·&nbsp;
                    Period: <strong>{selectedLock.days} days</strong>
                  </div>
                  {countdown && (
                    <div className="lock-countdown">â³ {countdown}</div>
                  )}
                  {isUnlocked && (
                    <div className="lock-countdown" style={{color:"#22c55e"}}>âœ“ Lock expired â€” ready to withdraw</div>
                  )}
                </div>
                <span className={`lock-badge ${isLocked ? "locked" : isUnlocked ? "unlocked" : "idle"}`}>
                  {isLocked ? "ğŸ”’ Locked" : isUnlocked ? "ğŸ”“ Unlocked" : "â€”"}
                </span>
              </div>
            )}
          </div>

          {/* Transaction History */}
          <div className="card">
            <h3>Transaction History</h3>
            {history.length === 0 && (
              <div className="history-item" style={{ borderBottom: "none" }}>No transactions yet.</div>
            )}
            {history.map((h, i) => (
              <div key={i} className="history-item">
                <span className={`badge ${badgeClass(h.type)}`}>{h.type}</span>
                <strong>{h.amount.toFixed(8)} BTC</strong>
                {h.type === "Stake" && h.lockDays && (
                  <span style={{ fontSize:"11px", color:"#f7931a", marginLeft:"8px", fontWeight:"bold" }}>
                    Â· {h.lockDays}d lock Â· {h.apy}% APY Â· until {h.lockUntil}
                  </span>
                )}
                <br />
                <span style={{ fontSize: "11px", color: "#6b7280" }}>
                  TX: {h.tx} Â· {h.date}
                </span>
              </div>
            ))}
          </div>

        </>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>
